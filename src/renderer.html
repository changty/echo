<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' data: blob:; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:;"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Echo</title>
    <!-- Tailwind output (built from tw.css) -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="text-zinc-100">
    <div
      id="shell"
      class="w-full backdrop-blur-2xl saturate-125 bg-zinc-900/85 rounded-2xl shadow-2xl p-3"
    >
      <div id="bar" class="flex justify-between items-center px-2.5 py-1.5">
        <span id="brand" class="font-bold tracking-wide opacity-90"
          >⌘ Echo</span
        >
        <div id="actions" class="flex items-center">
          <button id="act-ask" title="Mod+1" class="btn ml-2">
            Ask <span class="text-xs text-zinc-100 text-opacity-40"> (1)</span>
          </button>
          <button id="act-proof" title="Mod+2" class="btn ml-2">
            Proofread
            <span class="text-xs text-zinc-100 text-opacity-40"> (2)</span>
          </button>
          <button id="act-en" title="Mod+3" class="btn ml-2">
            To English
            <span class="text-xs text-zinc-100 text-opacity-40"> (3)</span>
          </button>
          <button id="act-to" title="Mod+4" class="btn ml-2">
            To… <span class="text-xs text-zinc-100 text-opacity-40"> (4)</span>
          </button>
          <button id="act-sum" title="Mod+5" class="btn ml-2">
            Summarize
            <span class="text-xs text-zinc-100 text-opacity-40"> (5)</span>
          </button>

          <button id="act-rewrite" title="Mod+6" class="btn ml-2">
            Rewrite
            <span class="text-xs text-zinc-100 text-opacity-40"> (6)</span>
          </button>
          <button
            id="btn-settings"
            title="Settings"
            class="btn ml-2 w-9 text-center p-1.5"
          >
            ⚙︎
          </button>
        </div>
      </div>

      <div id="content" class="px-2.5 pb-2.5">
        <textarea
          id="input"
          placeholder="Paste or type here…"
          class="w-full h-56 p-3.5 rounded-xl border border-white/10 bg-white/5 text-zinc-100 resize-none text-[15px] leading-6"
        ></textarea>
        <div id="imagePreview" hidden>
          <div class="flex items-center mt-2.5 gap-2">
            <img
              id="img"
              alt="clipboard image"
              class="h-12 rounded-lg border border-white/10"
            />
            <span class="hint text-xs text-zinc-400"
              >Image attached from clipboard</span
            >
          </div>
        </div>
        <div
          id="footer"
          class="flex justify-between mt-2 text-xs text-zinc-400 justify-end"
        >
          <span> Ctrl/⌘+Enter Run · Esc Close </span>
          <span id="provider"></span>
        </div>
      </div>
    </div>

    <!-- Settings Modal (single column & wider) -->
    <dialog
      id="settings"
      class="border border-white/15 bg-zinc-900/95 text-zinc-100 rounded-2xl p-5 w-[800px]"
    >
      <form id="settingsForm" class="space-y-3">
        <h3 class="text-base font-semibold">Settings</h3>

        <label class="flex flex-col gap-1.5 text-sm"
          >Global Hotkey
          <input
            id="s-hotkey"
            placeholder="Alt+Space"
            class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100 focus:outline-none focus:ring-2 focus:ring-accent/60 focus:border-accent/40"
          />
        </label>

        <label class="flex flex-col gap-1.5 text-sm"
          >Default Provider
          <select
            id="s-defaultProvider"
            class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100 focus:outline-none focus:ring-2 focus:ring-accent/60 focus:border-accent/40"
          ></select>
        </label>

        <label class="flex flex-col gap-1.5 text-sm"
          >Target language (default for Alt+3)
          <input
            id="s-targetLang"
            placeholder="Finnish"
            class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100 focus:outline-none focus:ring-2 focus:ring-accent/60 focus:border-accent/40"
          />
        </label>

        <h4 class="mt-4 mb-2 font-semibold">Providers</h4>
        <div id="prov-list" class="space-y-2 overflow-auto pr-1"></div>
        <div class="flex flex-col justify-end mt-2 mb-8">
          <button id="btn-add-provider" class="btn" type="button">
            Add Provider
          </button>
        </div>

        <menu class="flex justify-end gap-2 mt-4">
          <button type="button" class="btn" id="settingsClose">Close</button>
          <button id="saveSettings" class="btn" type="submit">Save</button>
        </menu>

        <p class="text-xs text-zinc-400">
          API keys are read from your .env according to provider (e.g.,
          OPENAI_API_KEY). Keys are not stored here.
        </p>
      </form>
    </dialog>

    <!-- Provider Editor Dialog -->
    <dialog
      id="providerDlg"
      class="border border-white/15 bg-zinc-900/95 text-zinc-100 rounded-2xl p-5 w-[560px]"
    >
      <!-- NOTE: normal form (NOT method="dialog"), we handle submit in JS -->
      <form id="providerForm" class="space-y-2">
        <input id="p-id" type="hidden" />

        <label class="flex flex-col gap-1.5 text-sm"
          >Label
          <input
            id="p-label"
            class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100"
          />
        </label>

        <label class="flex flex-col gap-1.5 text-sm"
          >Type
          <select
            id="p-type"
            class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100"
          >
            <option value="openai">OpenAI</option>
            <option value="openaiCompatible">OpenAI-Compatible</option>
            <option value="ollama">Ollama</option>
            <option value="gemini">Gemini</option>
          </select>
        </label>

        <div id="p-row-apiBase" class="flex flex-col gap-1.5 text-sm">
          <label
            >API Base
            <input
              id="p-apiBase"
              placeholder="https://api.openai.com/v1"
              class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100"
            />
          </label>
        </div>

        <div id="p-row-apiKey" class="flex flex-col gap-1.5 text-sm">
          <label
            >API Key
            <input
              id="p-apiKey"
              placeholder=""
              class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100"
            />
          </label>
        </div>

        <div id="p-row-host" class="flex flex-col gap-1.5 text-sm hidden">
          <label
            >Host (Ollama)
            <input
              id="p-host"
              placeholder="http://localhost:11434"
              class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100"
            />
          </label>
        </div>

        <label class="flex flex-col gap-1.5 text-sm"
          >Model
          <input
            id="p-model"
            placeholder="gpt-4o-mini / gemma3:27b"
            class="px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100"
          />
        </label>

        <menu class="flex justify-end gap-2 mt-3">
          <button type="button" id="providerCancelBtn" class="btn">
            Cancel
          </button>
          <button id="providerSaveBtn" type="submit" class="btn">
            Save Provider
          </button>
        </menu>
      </form>
    </dialog>

    <!-- Generic tiny prompt (replaces window.prompt) -->
    <dialog
      id="promptDlg"
      class="border border-white/15 bg-zinc-900/95 text-zinc-100 rounded-2xl p-4 w-[420px]"
    >
      <form method="dialog" id="promptForm">
        <h3 id="promptTitle" class="text-base font-semibold">Input</h3>
        <p class="text-xs text-zinc-400" id="promptHelp"></p>
        <input
          id="promptInput"
          placeholder=""
          class="mt-2 w-full px-2.5 py-2 rounded-lg bg-white/10 border border-white/10 text-zinc-100 focus:outline-none focus:ring-2 focus:ring-accent/60 focus:border-accent/40"
        />
        <menu class="flex justify-end gap-2 mt-3">
          <button id="promptOk" type="submit" class="btn" value="ok" autofocus>
            Ok
          </button>
          <button id="promptCancel" type="submit" class="btn" value="cancel">
            Cancel
          </button>
        </menu>
      </form>
    </dialog>

    <script type="module" src="renderer.js"></script>
  </body>
</html>
